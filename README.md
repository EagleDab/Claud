# üîç Price Monitor - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ü–µ–Ω –Ω–∞ —Å–∞–π—Ç–∞—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ –ú–æ–π–°–∫–ª–∞–¥.

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Telegram-–±–æ—Ç** (`bot/`) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
- **–ü–∞—Ä—Å–µ—Ä—ã —Å–∞–π—Ç–æ–≤** (`scraper/`) ‚Äî –º–æ–¥—É–ª—å–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è Petrovich, WhiteHills –∏ MK4S —Å –æ–±—Ö–æ–¥–æ–º –∞–Ω—Ç–∏–±–æ—Ç-–∑–∞—â–∏—Ç.
- **–¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** (`pricing/`) ‚Äî –¥–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –≤ –ú–æ–π–°–∫–ª–∞–¥.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (`scheduler/`) ‚Äî APScheduler + Celery –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–æ–π–°–∫–ª–∞–¥** (`msklad/`) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ü–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (`db/`) ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏ –∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `db/init.sql`.

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∞–≤–∏–ª –Ω–∞—Ü–µ–Ω–∫–∏: `+X%`, `-Y` —Ä—É–±–ª–µ–π, `=` —Ü–µ–Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞.
- –ü—Ä–∏–≤—è–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∏–ø–æ–≤ —Ü–µ–Ω –ú–æ–π–°–∫–ª–∞–¥ –∫ –æ–¥–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.
- –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω —á–µ—Ä–µ–∑ Telegram.
- –î–æ–∫–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ (bot + worker + scheduler + PostgreSQL + Redis).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker Compose)

> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.**

   ```bash
   cp .env.example .env
   nano .env  # –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
   ```

   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ `TELEGRAM_BOT_TOKEN`, —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ `TELEGRAM_ADMIN_IDS`,
   –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –ú–æ–π–°–∫–ª–∞–¥ (`MSKLAD_*`). –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ
   —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏–±–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–≤–æ–∏ —Å–µ—Ä–≤–∏—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–º–µ–Ω—è—Ç—å `DEFAULT_POLL_INTERVAL_MINUTES`).

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–µ—Ä–≤–∏—Å—ã.**

   ```bash
   docker compose up --build -d
   ```

   Compose –ø–æ–¥–Ω–∏–º–µ—Ç PostgreSQL, Redis, Telegram-–±–æ—Ç–∞, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ Celery worker. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ
   `db/init.sql` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω—É–∂–Ω—ã–µ —Å—Ö–µ–º—ã –ë–î.

3. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç.**

   ```bash
   docker compose ps
   docker compose logs -f bot      # –ª–æ–≥–∏ Telegram-–±–æ—Ç–∞
   docker compose logs -f worker   # —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
   ```

4. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ Telegram-–±–æ—Ç–∞.**

   –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather), –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –∏
   —Å–ª–µ–¥—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º. –°–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–∏–≤–µ–¥—ë–Ω –Ω–∏–∂–µ.

### üéõÔ∏è –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –û–° (–ø—Ä–∏–º–µ—Ä –¥–ª—è Debian/Ubuntu):

   ```bash
   sudo apt-get update && sudo apt-get install -y python3.11 python3.11-venv \
       gcc libpq-dev redis-server postgresql-client
   ```

   –¢–∞–∫–∂–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è Playwright Chromium. –í Dockerfile –º–æ–∂–Ω–æ –ø–æ–¥—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤,
   –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è headless-–±—Ä–∞—É–∑–µ—Ä–∞.

2. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ PostgreSQL –∏ Redis (—á–µ—Ä–µ–∑ `apt`, Docker –∏–ª–∏ –æ–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã) –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É `price_monitor`.

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   ```bash
   python3.11 -m venv .venv
   source .venv/bin/activate
   pip install --upgrade pip
   pip install -r requirements.txt
   playwright install chromium

   cp .env.example .env
   nano .env  # –ø—Ä–æ–ø–∏—à–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   ```

4. –ü—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –±–∞–∑—É (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL):

   ```bash
   psql postgresql://price_user:price_pass@localhost:5432/price_monitor -f db/init.sql
   ```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö –∏–ª–∏ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:

   ```bash
   # Telegram-–±–æ—Ç
   python -m bot.main

   # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
   python -m scheduler.main

   # Celery worker –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
   celery -A scheduler.celery_app worker --loglevel=info
   ```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`. –ö–æ–º–∞–Ω–¥—ã:

- `/add_product <url> <–∫–æ–¥> <—Ç–∏–ø=–ø—Ä–∞–≤–∏–ª–æ>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä.
- `/add_category <url>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –∏ —Å–≤—è–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã.
- `/set_rules <id> <—Ç–∏–ø=–ø—Ä–∞–≤–∏–ª–æ>` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
- `/set_price_types <id> <–∫–æ–¥> <—Ç–∏–ø1> [—Ç–∏–ø2 ...]` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥—ã –∏ —Ç–∏–ø—ã —Ü–µ–Ω.
- `/list` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.
- `/recheck <id>` ‚Äî –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
- `/delete <id>` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
- `/test_notify` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
pytest
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
